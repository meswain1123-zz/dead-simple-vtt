(this.webpackJsonpauthors_notebook=this.webpackJsonpauthors_notebook||[]).push([[0],Array(34).concat([function(e,t){e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBoRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAARAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMi4xMwAA/9sAQwACAQEBAQECAQEBAgICAgIEAwICAgIFBAQDBAYFBgYGBQYGBgcJCAYHCQcGBggLCAkKCgoKCgYICwwLCgwJCgoK/9sAQwECAgICAgIFAwMFCgcGBwoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoK/8AAEQgACgAKAwEhAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A/n/ooAKKAP/Z"},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"static/media/Basement-Study.a68280cb.jpg"},function(e,t,a){e.exports=a.p+"static/media/Castle-Wall.4fa9735d.jpg"},function(e,t,a){e.exports=a.p+"static/media/Cave-Lair.e48ad0f2.jpg"},function(e,t,a){e.exports=a.p+"static/media/Crossroads.b70bce05.jpg"},function(e,t,a){e.exports=a.p+"static/media/Farmstead.1802a7fa.jpg"},function(e,t,a){e.exports=a.p+"static/media/Forest-Lair.8706baa2.jpg"},function(e,t,a){e.exports=a.p+"static/media/Monster-Lair.906aa148.jpg"},function(e,t,a){e.exports=a.p+"static/media/Snow-Village.e08e1847.jpg"},function(e,t,a){e.exports=a.p+"static/media/Swamp-Lair.625e577e.jpg"},function(e,t,a){e.exports=a.p+"static/media/Tavern.9c60ea48.jpg"},function(e,t,a){e.exports=a.p+"static/media/Underground-Complex.ef43ba2b.jpg"},function(e,t,a){e.exports=a.p+"static/media/Urban-Lair.f9494f9d.jpg"},function(e,t,a){e.exports=a.p+"static/media/Wagon-Trail-and-Shrine.ad53d0a1.jpg"},function(e,t,a){e.exports=a.p+"static/media/Waterfall-Cavern.8d0ffe05.jpg"},function(e,t,a){e.exports=a.p+"static/media/AbandonedWarehouse.5bb80286.png"},function(e,t,a){e.exports=a.p+"static/media/DaggerAlley.469bcf6d.png"},function(e,t,a){e.exports=a.p+"static/media/UnderDaggerAlley.4588f8f4.png"},function(e,t,a){e.exports=a.p+"static/media/TrollSkullAlleyBasement.a7ce5ec0.png"},function(e,t,a){e.exports=a.p+"static/media/TrollSkullAlleyHouse.9a7bd522.png"},function(e,t,a){e.exports=a.p+"static/media/WeddingRing.cade6e88.png"},function(e,t,a){e.exports=a.p+"static/media/Bald.741a853e.png"},function(e,t,a){e.exports=a.p+"static/media/Bard.94af444d.png"},function(e,t,a){e.exports=a.p+"static/media/BlondeHair.4fcc70e3.png"},function(e,t,a){e.exports=a.p+"static/media/BlondeWoman.9762d835.png"},function(e,t,a){e.exports=a.p+"static/media/BlueSkin.df8f5004.png"},function(e,t,a){e.exports=a.p+"static/media/BlueSkin2.2603a58a.png"},function(e,t,a){e.exports=a.p+"static/media/DarkSkin.e48fb0f3.png"},function(e,t,a){e.exports=a.p+"static/media/DarkSkinF.ad2949fb.png"},function(e,t,a){e.exports=a.p+"static/media/Dragonborn.ab16b141.png"},function(e,t,a){e.exports=a.p+"static/media/DragonbornFighter.c21c5f7d.png"},function(e,t,a){e.exports=a.p+"static/media/DwarfMale.2c31b739.png"},function(e,t,a){e.exports=a.p+"static/media/ElvenFemale.4b6ed688.png"},function(e,t,a){e.exports=a.p+"static/media/ElvenFighter.855d86de.png"},function(e,t,a){e.exports=a.p+"static/media/Eyebrows.9e1fe3ec.png"},function(e,t,a){e.exports=a.p+"static/media/Eyebrows2.e428b8ea.png"},function(e,t,a){e.exports=a.p+"static/media/Fedora.ae081514.png"},function(e,t,a){e.exports=a.p+"static/media/GnomeMale.0a1ba63d.png"},function(e,t,a){e.exports=a.p+"static/media/GoliathBarb.33cfc33d.png"},function(e,t,a){e.exports=a.p+"static/media/GreyHair.c1b9e380.png"},function(e,t,a){e.exports=a.p+"static/media/HalflingMale.639efdd9.png"},function(e,t,a){e.exports=a.p+"static/media/Hood.9db2c27f.png"},function(e,t,a){e.exports=a.p+"static/media/Hood2.70d96a27.png"},function(e,t,a){e.exports=a.p+"static/media/Human.52eda96a.png"},function(e,t,a){e.exports=a.p+"static/media/HumanFemale.81c31b30.png"},function(e,t,a){e.exports=a.p+"static/media/HumanFemale2.a4ff5aca.png"},function(e,t,a){e.exports=a.p+"static/media/HumanFighterF.533cf974.png"},function(e,t,a){e.exports=a.p+"static/media/HumanFighterM.77a0b7de.png"},function(e,t,a){e.exports=a.p+"static/media/HumanMale.69efd308.png"},function(e,t,a){e.exports=a.p+"static/media/HumanMale2.19c85bbc.png"},function(e,t,a){e.exports=a.p+"static/media/idk.8cdd4c94.png"},function(e,t,a){e.exports=a.p+"static/media/Knight.7d208560.png"},function(e,t,a){e.exports=a.p+"static/media/OldWoman.b670e555.png"},function(e,t,a){e.exports=a.p+"static/media/OldWoman2.28ceea26.png"},function(e,t,a){e.exports=a.p+"static/media/RedHair.75d09fc6.png"},function(e,t,a){e.exports=a.p+"static/media/RedSkin.bd87a612.png"},function(e,t,a){e.exports=a.p+"static/media/Samurai.cbbf87ae.png"},function(e,t,a){e.exports=a.p+"static/media/Scarf.e6d10ad6.png"},function(e,t,a){e.exports=a.p+"static/media/TieflingFemale.1ee22c7c.png"},function(e,t,a){e.exports=a.p+"static/media/Wizard.6cbb3902.png"},function(e,t,a){e.exports=a.p+"static/media/Rat.7b728608.png"},function(e,t,a){e.exports=a.p+"static/media/Wererat.d2f36299.png"},function(e,t,a){e.exports=a.p+"static/media/Werewolf.17e32e13.png"},function(e,t,a){e.exports=a.p+"static/media/RugOfSmothering.39f39c68.jpeg"},function(e,t,a){e.exports=a.p+"static/media/PitTrapWSpikes.9c811852.png"},,,,,function(e,t,a){e.exports=a(148)},,,,,function(e,t,a){},function(e,t,a){},,,,,,,,function(e,t,a){},,,,,,,function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(27),o=a.n(i),s=(a(132),a(4)),l=a(11),c=a(14),p=a(13),d=(a(133),a(41)),u=a(12),f=a(9),m=a(165);var h=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={version:"0",redirectTo:null},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.props.fromLogin&&this.props.notFromLogin(),null!==this.state.redirectTo?r.a.createElement(f.a,{to:this.state.redirectTo}):r.a.createElement("div",null,r.a.createElement("h3",null,"Dead Simple Virtual Table Top"),r.a.createElement("p",null,"This is a Virtual Table Top I'm making for my friends and I to use for D&D."),r.a.createElement("p",null,"It will have two pages.  The DM page and the player page. There will be a canvas with zoom and pan capabilities. The canvas will have three layers.  The bottom layer is the map.  The middle layer is the token layer, and it will have tokens representing anything which can be interacted with. The top layer is the fog layer, and it will contain the fog of war as well as magical darkness."),r.a.createElement("p",null,"The canvas will make an X * Y grid, and the map layer will fill the grid.  Each token will have a numerical size representing the diameter of the object.  Small and Medium creatures will have a size of 1.  Large creatures will have a size of 2.  Etc.  If tokens are added to represent other objects with other shape types (ladders, ropes, etc), then for now they can be represented using multiple tokens."),r.a.createElement("p",null,"The fog of war will cover everything except for what the DM chooses to reveal.  It will be done by placing a 1x1 image over each square of the map that is covered by the fog of war. On the DM page these images will have 30% opacity."),r.a.createElement("p",null,"The player page will show whatever the DM page shows, except with opaque fog of war and no controls. (Later I might make it so the DM can set what the player page sees independantly of what they see.)"),r.a.createElement("p",null,"The DM page will have these abilities: Create a map (takes an image and X and Y values). Open a map. Pan/Zoom. Add/Remove tokens. Move tokens. Add/Remove fog of war."),r.a.createElement("p",null,r.a.createElement(m.a,{container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0},"Known bugs:"),r.a.createElement(m.a,{item:!0},"Clicking on the map doesn't always get the spot you clicked quite right.  This is because I'm trying to translate the actual pixels you're clicking on to the location on the grid, and then back again for rendering.  The math is mostly right, but things get funky with all the zooms and pans that need to be taken into account.  I'll fix it later."),r.a.createElement(m.a,{item:!0},"I'm also still working on getting the UI for the Fog Of War controls sorted out on the DM page."))))}}]),a}(n.Component),g=Object(u.b)((function(e){return{}}),(function(e){return{}}))(h),y=a(23),k=a(24),v=a(168),M=a(170),b=a(171),E=a(169),w=a(167),x=function e(t,a,n,r,i,o,l,c,p,d){var u=this;Object(s.a)(this,e),this._id=void 0,this.name=void 0,this.map=void 0,this.tokens=void 0,this.lightMasks=void 0,this.darkMasks=void 0,this.fogMasks=void 0,this.zoom=void 0,this.dx=void 0,this.dy=void 0,this.toDBObj=function(){var e=[];u.tokens.forEach((function(t){e.push(t.toDBObj())}));var t=[];u.lightMasks.forEach((function(e){t.push(e.toDBObj())}));var a=[];u.darkMasks.forEach((function(e){a.push(e.toDBObj())}));var n=[];return u.fogMasks.forEach((function(e){n.push(e.toDBObj())})),{_id:u._id,name:u.name,mapID:u.map._id,playTokens:e,lightMasks:t,darkMasks:a,fogMasks:n,zoom:u.zoom,dx:u.dx,dy:u.dy}},this._id=t,this.name=a,this.map=n,this.tokens=r,this.lightMasks=i,this.darkMasks=o,this.fogMasks=l,this.zoom=c,this.dx=p,this.dy=d},P=a(16),A=a(2),_=a.n(A),S=a(6);function T(e){this.name="UnauthorizedError",this.message=e}T.prototype=new Error;var D=function(){var e;return{getInstance:function(){return e||(e=new O),e}}}(),O=function e(){var t=this;Object(s.a)(this,e),this.logErrorReason=function(e){return console.log("Response error reason:",e),Promise.reject(e)},this.checkStatus=function(e){if(e.status>=200&&e.status<300)return e;if(401===e.status){var t=new T(e.statusText);return t.response=e,Promise.reject(t)}var a=new Error(e.statusText);return a.response=e,Promise.reject(a)},this.getAllVTT=function(){var e=Object(S.a)(_.a.mark((function e(a,n){var r,i,o,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getMaps(a,n);case 2:return r=e.sent,e.next=5,t.getTokens(a,n);case 5:return i=e.sent,e.next=8,t.getPlayMaps(a,n);case 8:return o=e.sent,e.next=11,t.getFavoriteTokens(a,n);case 11:return s=e.sent,e.abrupt("return",{maps:r.maps,tokens:i.tokens,playMaps:o.playMaps,favoriteTokens:s.favoriteTokens});case 13:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.getMaps=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>1&&void 0!==r[1]&&r[1])){e.next=5;break}return e.abrupt("return",t.getMapsFromAPI(a));case 5:if(null===(n=t.getSessionData("maps"))){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",t.getMapsFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getMapsFromAPI=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=10;break}return e.next=3,t.fetchData("/api/vtt/getMaps/".concat(a));case 3:return n=e.sent,e.next=6,t.processResponse(n,null,"maps");case 6:return r=e.sent,e.abrupt("return",r);case 10:return e.abrupt("return",[{_id:-1,vttID:-1,Name:"Alice"}]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/vtt/createMap",{map:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return",-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.deleteData("/api/vtt/deleteMap",{mapID:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/vtt/updateMap",{map:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTokens=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>1&&void 0!==r[1]&&r[1])){e.next=5;break}return e.abrupt("return",t.getTokensFromAPI(a));case 5:if(null===(n=t.getSessionData("tokens"))){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",t.getTokensFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTokensFromAPI=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=10;break}return e.next=3,t.fetchData("/api/vtt/getTokens/".concat(a));case 3:return n=e.sent,e.next=6,t.processResponse(n,null,"tokens");case 6:return r=e.sent,e.abrupt("return",r);case 10:return e.abrupt("return",[{_id:-1,vttID:-1,Name:"Alice"}]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createToken=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/vtt/createToken",{token:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return",-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteToken=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.deleteData("/api/vtt/deleteToken",{tokenID:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateToken=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/vtt/updateToken",{token:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPlayMaps=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>1&&void 0!==r[1]&&r[1])){e.next=5;break}return e.abrupt("return",t.getPlayMapsFromAPI(a));case 5:if(null===(n=t.getSessionData("playMaps"))){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",t.getPlayMapsFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPlayMapsFromAPI=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=10;break}return e.next=3,t.fetchData("/api/vtt/getPlayMaps/".concat(a));case 3:return n=e.sent,e.next=6,t.processResponse(n,null,"playMaps");case 6:return r=e.sent,e.abrupt("return",r);case 10:return e.abrupt("return",[{_id:-1,vttID:-1,Name:"Alice"}]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getPlayMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchData("/api/vtt/getPlayMap/".concat(a));case 2:return n=e.sent,e.next=5,t.processResponse(n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createPlayMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/vtt/createPlayMap",{playMap:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return",-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deletePlayMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.deleteData("/api/vtt/deletePlayMap",{playMapID:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updatePlayMap=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/vtt/updatePlayMap",{playMap:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getFavoriteTokens=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>1&&void 0!==r[1]&&r[1])){e.next=5;break}return e.abrupt("return",t.getFavoriteTokensFromAPI(a));case 5:if(null===(n=t.getSessionData("favoriteTokens"))){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",t.getFavoriteTokensFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getFavoriteTokensFromAPI=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=10;break}return e.next=3,t.fetchData("/api/vtt/getFavoriteTokens/".concat(a));case 3:return n=e.sent,e.next=6,t.processResponse(n,null,"favoriteTokens");case 6:return r=e.sent,e.abrupt("return",r);case 10:return e.abrupt("return",[{_id:-1,vttID:-1,Name:"Alice"}]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createFavoriteToken=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/vtt/createFavoriteToken",{favoriteToken:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return",-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteFavoriteToken=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.deleteData("/api/vtt/deleteFavoriteToken",{favoriteTokenID:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateFavoriteToken=function(){var e=Object(S.a)(_.a.mark((function e(a){var n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/vtt/updateFavoriteToken",{favoriteToken:a});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n,null));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.fetchData=function(){var e=Object(S.a)(_.a.mark((function e(a){var n,r=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,fetch("".concat(a),Object(P.a)(Object(P.a)({mode:"cors",credentials:"include"},n),{},{headers:Object(P.a)({Accept:"application/json"},n.headers)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.postData=function(){var e=Object(S.a)(_.a.mark((function e(a,n){var r,i=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(P.a)(Object(P.a)({mode:"cors",credentials:"include"},r),{},{headers:Object(P.a)({Accept:"application/json","Content-Type":"application/json"},r.headers),method:"POST",body:JSON.stringify(n)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.putData=function(){var e=Object(S.a)(_.a.mark((function e(a,n){var r,i=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(P.a)(Object(P.a)({mode:"cors",credentials:"include"},r),{},{headers:Object(P.a)({Accept:"application/json","Content-Type":"application/json"},r.headers),method:"PUT",body:JSON.stringify(n)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.patchData=function(){var e=Object(S.a)(_.a.mark((function e(a,n){var r,i=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(P.a)(Object(P.a)({mode:"cors",credentials:"include"},r),{},{headers:Object(P.a)({Accept:"application/json","Content-Type":"application/json"},r.headers),method:"PATCH",body:JSON.stringify(n)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.deleteData=function(){var e=Object(S.a)(_.a.mark((function e(a,n){var r,i=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(P.a)(Object(P.a)({mode:"cors",credentials:"include"},r),{},{headers:Object(P.a)({Accept:"application/json","Content-Type":"application/json"},r.headers),method:"DELETE",body:JSON.stringify(n)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.processResponse=function(){var e=Object(S.a)(_.a.mark((function e(t){var a,n,r,i,o,s,l=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null,n=l.length>2&&void 0!==l[2]?l[2]:null,r=l.length>3&&void 0!==l[3]&&l[3],e.next=5,t.json();case 5:if(i=e.sent,200===t.status){e.next=10;break}throw Error(i.message);case 10:if(void 0===i.error||null===a){e.next=14;break}return e.abrupt("return",a());case 14:return null!==n&&(o=new Date,r?o="never":o.setHours(o.getHours()+1),s={expiresAt:o,body:i},sessionStorage.setItem(n,JSON.stringify(s))),e.abrupt("return",i);case 16:case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.relogin=Object(S.a)(_.a.mark((function e(){var a,n;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null===(a=t.getSessionData("loginUser"))){e.next=7;break}return e.next=5,t.postData("/api/user/login",a);case 5:n=e.sent,t.processResponse(n,null,"user",!0);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.getSessionData=function(e){var t=sessionStorage.getItem(e);if(null!==t){var a=JSON.parse(t);if(void 0!==a.expiresAt&&("never"===a.expiresAt||a.expiresAt>new Date))return a.body}return null},this.real=!0},C=D,j=Object(u.b)((function(e){return{maps:e.app.maps}}),{addPlayMap:function(e){return{type:"ADD_PLAYMAP",payload:e}}})(function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).api=void 0,n.renderHeader=function(){return r.a.createElement("div",{key:"header"},"Select a Map and give the PlayMap a name.")},n.selectMap=function(e){if(""===n.state.name){var t=new Date,a=(t.getMonth()+1).toString();1===a.length&&(a="0"+a);var r=t.getDate().toString();1===r.length&&(r="0"+r),n.setState({selectedMap:e,name:"".concat(e.name," ").concat(t.getFullYear()).concat(a).concat(r)})}else n.setState({selectedMap:e})},n.createPlayMap=function(){n.setState({processing:!0},(function(){if(null!==n.state.selectedMap){var e={mapID:n.state.selectedMap._id,name:n.state.name,playTokens:[],lightMasks:[],darkMasks:[],fogMasks:[],zoom:1,dx:0,dy:0};n.api.createPlayMap(e).then((function(e){if(void 0!==e&&void 0===e.error&&n.state.selectedMap){var t=new x(e.playMapID,n.state.name,n.state.selectedMap,[],[],[],[],1,0,0);n.props.addPlayMap(t),n.props.selectPlayMap(t),n.setState({processing:!1})}}))}}))},n.onBlur=function(){n.setState({name:n.state.name.trim()},(function(){}))},n.renderMain=function(){return null===n.props.maps?r.a.createElement("div",{key:"main"},"I'm invisible"):r.a.createElement(m.a,{key:"main",container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_map_name"},"PlayMap Name"),r.a.createElement(E.a,{id:"text_field_play_map_name",name:"text_field_play_map_name",type:"text",autoComplete:"Off",error:""!==n.state.error,value:n.state.name,onChange:function(e){n.setState({name:e.target.value})},onBlur:function(){n.onBlur()},labelWidth:120,fullWidth:!0}),r.a.createElement(w.a,null,n.state.error))),r.a.createElement(m.a,{item:!0,style:{height:window.innerHeight-200,overflowY:"scroll"},container:!0,spacing:1,direction:"row"},n.renderMapList(),n.renderSelectedMap()),r.a.createElement(m.a,{item:!0},r.a.createElement(v.a,{disabled:n.state.processing||null===n.state.selectedMap||""===n.state.name,onClick:n.createPlayMap,variant:"contained",color:"primary"},"Submit")))},n.renderMapList=function(){return null!==n.props.maps?r.a.createElement(m.a,{item:!0,xs:6,container:!0,spacing:1,direction:"column"},"Select a Map",n.props.maps.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,onClick:function(){n.selectMap(e)},style:{backgroundColor:n.state.selectedMap&&n.state.selectedMap._id===e._id?"blue":"transparent",color:n.state.selectedMap&&n.state.selectedMap._id===e._id?"white":"black",cursor:"pointer"}},e.name)}))):r.a.createElement(m.a,{item:!0,xs:6},"I'm invisible!")},n.renderSelectedMap=function(){return null!==n.state.selectedMap?r.a.createElement(m.a,{item:!0,xs:6,container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0},"Grid Width: ",n.state.selectedMap.gridWidth),r.a.createElement(m.a,{item:!0},"Grid Height: ",n.state.selectedMap.gridHeight),r.a.createElement(m.a,{item:!0},r.a.createElement("img",{style:{width:"100%"},src:n.state.selectedMap.file,alt:"testing"}))):r.a.createElement(m.a,{item:!0,xs:6})},n.state={name:"",selectedMap:null,error:"",processing:!1},n.api=C.getInstance(),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return[this.renderHeader(),this.renderMain()]}}]),a}(n.Component)),W=Object(u.b)((function(e){return{playMaps:e.app.playMaps}}),{})(function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).selectPlayMap=function(e){n.setState({selectedMap:e})},n.loadPlayMap=function(){null!==n.state.selectedMap&&n.props.selectPlayMap(n.state.selectedMap)},n.renderMain=function(){return null===n.props.playMaps?r.a.createElement("div",{key:"main"},"I'm invisible"):r.a.createElement(m.a,{key:"main",style:{margin:4},container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0,style:{height:window.innerHeight-200,overflowY:"scroll"},container:!0,spacing:1,direction:"row"},n.renderMapList(),n.renderSelectedMap()),r.a.createElement(m.a,{item:!0},r.a.createElement(v.a,{disabled:null===n.state.selectedMap,onClick:n.loadPlayMap,variant:"contained",color:"primary"},"Submit")))},n.renderMapList=function(){return null!==n.props.playMaps?r.a.createElement(m.a,{item:!0,xs:6,container:!0,spacing:1,direction:"column"},"Select a Map",n.props.playMaps.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,onClick:function(){n.selectPlayMap(e)},style:{backgroundColor:n.state.selectedMap&&n.state.selectedMap._id===e._id?"blue":"transparent",color:n.state.selectedMap&&n.state.selectedMap._id===e._id?"white":"black",cursor:"pointer"}},e.name)}))):r.a.createElement(m.a,{item:!0,xs:6},"I'm invisible!")},n.renderSelectedMap=function(){return null!==n.state.selectedMap&&"DM"===n.props.mode?r.a.createElement(m.a,{item:!0,xs:6,container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0},"Grid Width: ",n.state.selectedMap.map.gridWidth),r.a.createElement(m.a,{item:!0},"Grid Height: ",n.state.selectedMap.map.gridHeight),r.a.createElement(m.a,{item:!0},r.a.createElement("img",{style:{width:"100%"},src:n.state.selectedMap.map.file,alt:"testing"}))):r.a.createElement(m.a,{item:!0,xs:6})},n.state={selectedMap:null},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return[this.renderMain()]}}]),a}(n.Component)),F=a(123),H=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).getInitialState=function(){var t=e.props,a=t.pandx,n=t.pandy,r=t.zoom;return{dragData:{dx:a,dy:n,x:0,y:0},dragging:!1,matrixData:[r,0,0,r,a,n]}},e.panWrapper=void 0,e.panContainer=void 0,e.state=e.getInitialState(),e.onMouseDown=function(t){if(e.props.enableClick&&e.props.onClick&&e.props.onClick(t.pageX,t.pageY),e.props.enablePan){var a=e.state,n=a.matrixData,r=(a.dragData,{dx:n[4],dy:n[5],x:t.pageX,y:t.pageY});e.setState({dragData:r,dragging:!0}),e.panWrapper&&(e.panWrapper.style.cursor="move"),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),t.preventDefault()}},e.onMouseUp=function(){e.setState({dragging:!1}),e.panWrapper&&(e.panWrapper.style.cursor=""),!e.props.enableClick&&e.props.onPan&&e.props.onPan(e.state.matrixData[4],e.state.matrixData[5])},e.getNewMatrixData=function(t,a){var n=e.state,r=n.dragData,i=n.matrixData,o=r.x-t,s=r.y-a;return i[4]=r.dx-o,i[5]=r.dy-s,i},e.onMouseMove=function(t){if(e.state.dragging){var a=e.getNewMatrixData(t.pageX,t.pageY);e.setState({matrixData:a}),e.panContainer&&(e.panContainer.style.transform="matrix(".concat(e.state.matrixData.toString(),")"))}},e}return Object(l.a)(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.state.matrixData,a=e.zoom,n=void 0===a?t[0]:a,r=e.pandx,i=void 0===r?t[4]:r,o=e.pandy,s=void 0===o?t[5]:o,l=Object(F.a)(this.state.matrixData);t[0]!==n&&(l[0]=n||l[0],l[3]=n||l[3]),t[4]!==i&&(l[4]=i),t[5]!==s&&(l[5]=s),this.setState({matrixData:l})}},{key:"render",value:function(){var e=this;return n.createElement("div",{className:"pan-container ".concat(this.props.className||""),onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove,style:{height:this.props.height,userSelect:"none",width:this.props.width,backgroundColor:"black"},ref:function(t){return e.panWrapper=t}},n.createElement("div",{ref:function(t){return t?e.panContainer=t:null},style:{transform:"matrix(".concat(this.state.matrixData.toString(),")")}},this.props.children))}}]),a}(n.PureComponent);H.defaultProps={enablePan:!0,enableClick:!1,onPan:function(){},onClick:function(){},pandx:0,pandy:0,zoom:1};var I=function e(t,a,n,r,i,o){var l=this;Object(s.a)(this,e),this.id=void 0,this.name=void 0,this.token=void 0,this.x=void 0,this.y=void 0,this.size=void 0,this.toDBObj=function(){return{id:l.id,name:l.name,tokenID:l.token._id,x:l.x,y:l.y,size:l.size}},this.id=t,this.name=a,this.token=n,this.x=r,this.y=i,this.size=o},z=function e(t,a,n,r,i){var o=this;Object(s.a)(this,e),this.id=void 0,this.maskID=void 0,this.maskType=void 0,this.x=void 0,this.y=void 0,this.toClipPathPoint=function(e,t){var a=50*(o.x+e/2)-50,n=50*(o.y+t/2)-25;return"".concat(a,",").concat(n)},this.toDBObj=function(){return{id:o.id,x:o.x,y:o.y}},this.id=t,this.maskID=a,this.maskType=n,this.x=r,this.y=i},R=function e(t,a,n){var r=this;Object(s.a)(this,e),this.id=void 0,this.maskType=void 0,this.points=void 0,this.toClipPath=function(e,t){var a="";return r.points.forEach((function(n){a+=n.toClipPathPoint(e,t)+" "})),a},this.toDBObj=function(){var e=[];return r.points.forEach((function(t){e.push(t.toDBObj())})),{id:r.id,points:e}},this.id=t,this.maskType=a,this.points=n},B=function e(t,a,n,r){var i=this;Object(s.a)(this,e),this._id=void 0,this.name=void 0,this.token=void 0,this.size=void 0,this.toDBObj=function(){return{_id:i._id,name:i.name,tokenID:i.token._id,size:i.size}},this._id=t,this.name=a,this.token=n,this.size=r},L=a(34),N=a.n(L);function K(){var e=Object(y.a)(["\n      ",";\n    "]);return K=function(){return e},e}function Y(){var e=Object(y.a)(["\n  font-size: 2rem;\n"]);return Y=function(){return e},e}function Q(){var e=Object(y.a)(["\n  background: dimgrey;\n  color: white;\n  height: ","px;\n  display: flex;\n  align-items: center;\n  padding-left: 10px;\n"]);return Q=function(){return e},e}function U(){var e=Object(y.a)(["\n  position: fixed;\n  background: lightgray;\n  height: 100%;\n  right: 0;\n  z-index: 2;\n  cursor: pointer;\n  user-select: none;\n\n  > div {\n    padding: 15px;\n    &:hover {\n      background: darkgray;\n    }\n    &:active {\n      box-shadow: 1px 1px 1px inset;\n    }\n  }\n"]);return U=function(){return e},e}function V(){var e=Object(y.a)(["\n  height: calc(100vh - ","px);\n  width: 100vw;\n  overflow: hidden;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1;\n"]);return V=function(){return e},e}var G=Object(k.a)(V(),30),X=k.b.div(U()),J=k.b.div(Q(),30),Z=k.b.strong(Y()),q=Object(u.b)((function(e){return{selectedPlayMap:e.app.selectedPlayMap,tokens:e.app.tokens,favoriteTokens:e.app.favoriteTokens,maps:e.app.maps}}),{addFavoriteToken:function(e){return{type:"ADD_FAVORITETOKEN",payload:e}},updateFavoriteToken:function(e){return{type:"UPDATE_FAVORITETOKEN",payload:e}},updatePlayMap:function(e){return{type:"UPDATE_PLAYMAP",payload:e}}})(function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).api=void 0,n.countdown=function(){n.state.countdown>0?n.setState({countdown:n.state.countdown-1},(function(){setTimeout(n.countdown,1e3)})):n.setState({countdown:0,refreshing:!0},n.refresh)},n.refresh=function(){n.api.getPlayMap(n.props.selectedPlayMap._id).then((function(e){var t=n.props.maps.filter((function(t){return t._id===e.mapID}));if(1===t.length){var a=t[0],r=[];e.playTokens.forEach((function(e){var t=n.props.tokens.filter((function(t){return t._id===e.tokenID}));if(1===t.length){var a=t[0];r.push(new I(e.id,e.name,a,e.x,e.y,e.size))}}));var i=[];e.lightMasks.forEach((function(e){var t=[];e.points.forEach((function(a){t.push(new z(a.id,e.id,"light",a.x,a.y))})),i.push(new R(e.id,"light",t))}));var o=[];e.darkMasks.forEach((function(e){var t=[];e.points.forEach((function(a){t.push(new z(a.id,e.id,"dark",a.x,a.y))})),o.push(new R(e.id,"dark",t))}));var s=[];e.fogMasks.forEach((function(e){var t=[];e.points.forEach((function(a){t.push(new z(a.id,e.id,"fog",a.x,a.y))})),s.push(new R(e.id,"fog",t))}));var l=new x(e._id,e.name,a,r,i,o,s,e.zoom,e.dx,e.dy);n.props.updatePlayMap(l),n.setState({refreshing:!1,countdown:4,lastRefresh:new Date},(function(){setTimeout(n.countdown,1e3)}))}}))},n.zoomIn=function(){if(n.props.selectedPlayMap){var e=n.props.selectedPlayMap;e.zoom+=.2,n.props.updatePlayMap(e),n.setState({lastRefresh:new Date})}},n.zoomOut=function(){if(n.props.selectedPlayMap){var e=n.props.selectedPlayMap;e.zoom-=.2,n.props.updatePlayMap(e),n.setState({lastRefresh:new Date})}},n.clearSelectAndHover=function(){n.setState({mapMode:"pan",selected:[],hovered:null})},n.addNewToken=function(){if(n.props.selectedPlayMap){var e=n.props.selectedPlayMap;if(n.state.selectedToken){for(var t=n.state.selectedToken,a=0;a<n.state.tokenCount;a++)e.tokens.push(new I(e.tokens.length,n.state.tokenName.trim()+(a>0?" ".concat(a+1):""),t,a-Math.round(n.state.tokenCount/2),0,n.state.tokenSize));n.props.updatePlayMap(e),n.setState({lastRefresh:new Date})}else if(n.state.selectedFavoriteToken){var r=n.state.selectedFavoriteToken;e.tokens.push(new I(e.tokens.length,n.state.tokenName.trim(),r.token,0,0,n.state.tokenSize)),n.props.updatePlayMap(e),n.setState({lastRefresh:new Date})}}},n.deletePlayToken=function(e){if(n.props.selectedPlayMap){var t=n.props.selectedPlayMap;t.tokens=t.tokens.filter((function(t){return t.id!==e.id})),t.tokens.filter((function(t){return t.id>e.id})).forEach((function(e){e.id--})),n.props.updatePlayMap(t),n.setState({lastRefresh:new Date})}},n.adjustPlayToken=function(e,t,a,r,i){if(n.props.selectedPlayMap){var o=n.props.selectedPlayMap,s=e,l=o.tokens.filter((function(e){return e.id===s.id}));if(1===l.length){var c=l[0];c.name=t,c.size=a,c.x=r,c.y=i,n.props.updatePlayMap(o),n.setState({lastRefresh:new Date,hovered:c})}}},n.addNewFavorite=function(){if(n.state.selectedToken){var e=n.state.selectedToken,t={name:n.state.tokenName,tokenID:e._id,size:n.state.tokenSize};n.api.createFavoriteToken(t).then((function(t){var a=new B(t.favoriteTokenID,n.state.tokenName,e,n.state.tokenSize);n.props.addFavoriteToken(a),n.setState({lastRefresh:new Date})}))}},n.deleteFavorite=function(e){if(n.props.selectedPlayMap){var t=n.props.selectedPlayMap;t.tokens=t.tokens.filter((function(t){return t.id!==e.id})),t.tokens.filter((function(t){return t.id>e.id})).forEach((function(e){e.id--})),n.props.updatePlayMap(t),n.setState({lastRefresh:new Date})}},n.adjustFavorite=function(e,t,a){var r=e,i=n.props.favoriteTokens.filter((function(e){return e._id===r._id}));if(1===i.length){var o=i[0];o.name=t,o.size=a,n.api.updateFavoriteToken(o.toDBObj()).then((function(){n.props.updateFavoriteToken(o),n.setState({lastRefresh:new Date})}))}},n.onPan=function(e,t){if(n.props.selectedPlayMap&&"DM"===n.props.mode){var a=n.props.selectedPlayMap;if(n.state.deselecting)n.setState({deselecting:!1});else if(null===n.state.hovered&&0===n.state.selected.length)a.dx=e,a.dy=t,n.props.updatePlayMap(a),n.setState({lastRefresh:new Date});else if(null!==n.state.hovered&&n.state.selected.includes(n.state.hovered));else if(null!==n.state.hovered&&(0===n.state.selected.length||n.state.shiftHeld)){var r=n.state.selected;r.push(n.state.hovered),n.setState({selected:r,mapMode:"move"})}}},n.onClick=function(e,t){if(n.state.selected.length>0&&n.props.selectedPlayMap&&"DM"===n.props.mode){var a=n.props.selectedPlayMap;if(null===n.state.hovered)1===n.state.selected.length&&n.state.selected.forEach((function(r){if(r instanceof I){var i=r,o=a.tokens.filter((function(e){return e.id===i.id}));if(1===o.length){var s=o[0];s.x=Math.round((e-window.innerWidth/2-a.dx+25)/a.zoom/50),s.y=Math.round((t-window.innerHeight/2-a.dy-37.5)/a.zoom/50),n.props.updatePlayMap(a),n.setState({lastRefresh:new Date,hovered:s})}}else if(r instanceof z){var l=r,c=("light"===r.maskType?n.props.selectedPlayMap.lightMasks:"dark"===r.maskType?n.props.selectedPlayMap.darkMasks:n.props.selectedPlayMap.fogMasks).filter((function(e){return e.id===l.maskID}));if(1===c.length){var p=c[0].points.filter((function(e){return e.id===l.id}));if(1===p.length){var d=p[0];d.x=(e-window.innerWidth/2-a.dx+50)/a.zoom/50,d.y=(t-window.innerHeight/2-a.dy)/a.zoom/50,n.props.updatePlayMap(a),n.setState({lastRefresh:new Date,hovered:d})}}}}));else if(n.state.selected.includes(n.state.hovered)){var r=n.state.selected.filter((function(e){return e!==n.state.hovered}));0===r.length?n.setState({selected:r,mapMode:"pan",deselecting:!0}):n.setState({selected:r,deselecting:!0})}else if(0===n.state.selected.length||n.state.shiftHeld){var i=n.state.selected;i.push(n.state.hovered),n.setState({selected:i,mapMode:"move"})}}},n.renderFavoriteTokenList=function(e){return e?r.a.createElement(m.a,{item:!0,container:!0,spacing:1,direction:"row"},n.props.favoriteTokens.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_favorite_token_name_".concat(t)},"Name"),r.a.createElement(E.a,{id:"text_field_favorite_token_name_".concat(t),name:"text_field_favorite_token_name_".concat(t),type:"text",autoComplete:"Off",value:e.name,onChange:function(t){n.adjustFavorite(e,t.target.value,e.size)},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_favorite_token_size_".concat(t)},"Size"),r.a.createElement(E.a,{id:"text_field_favorite_token_size_".concat(t),name:"text_field_favorite_token_size_".concat(t),type:"number",autoComplete:"Off",value:e.size,onChange:function(t){n.adjustFavorite(e,e.name,parseFloat(t.target.value))},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement("img",{src:e.token.file,style:{width:140},alt:e.name})),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){}},"Delete")))}))):r.a.createElement(m.a,{item:!0,container:!0,spacing:1,direction:"row"},n.props.favoriteTokens.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,xs:6,style:{cursor:"pointer",backgroundColor:null!==n.state.selectedFavoriteToken&&e._id===n.state.selectedFavoriteToken._id?"blue":"transparent"},onClick:function(){n.setState({selectedFavoriteToken:e,selectedToken:null,tokenName:e.name,tokenSize:e.size})}},r.a.createElement("img",{src:e.token.file,style:{width:140},alt:e.name}),e.name)})))},n.renderTokenList=function(){return r.a.createElement(m.a,{item:!0,container:!0,spacing:1,direction:"row"},n.props.tokens.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,xs:6,style:{cursor:"pointer",backgroundColor:null!==n.state.selectedToken&&e._id===n.state.selectedToken._id?"blue":"transparent"},onClick:function(){n.setState({selectedToken:e,selectedFavoriteToken:null})}},r.a.createElement("img",{src:e.file,style:{width:140},alt:e.file}))})))},n.renderPlayTokenList=function(){return r.a.createElement(m.a,{item:!0,container:!0,spacing:1,direction:"column"},n.props.selectedPlayMap.tokens.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:3},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_name_".concat(t)},"Name"),r.a.createElement(E.a,{id:"text_field_play_token_name_".concat(t),name:"text_field_play_token_name_".concat(t),type:"text",autoComplete:"Off",value:e.name,onChange:function(t){n.adjustPlayToken(e,t.target.value,e.size,e.x,e.y)},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:3},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_size_".concat(t)},"Size"),r.a.createElement(E.a,{id:"text_field_play_token_size_".concat(t),name:"text_field_play_token_size_".concat(t),type:"number",autoComplete:"Off",value:e.size,onChange:function(t){n.adjustPlayToken(e,e.name,parseFloat(t.target.value),e.x,e.y)},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:3},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_lmp_x_".concat(t)},"X"),r.a.createElement(E.a,{id:"text_field_lmp_x_".concat(t),name:"text_field_lmp_x_".concat(t),type:"number",autoComplete:"Off",value:e.x,onChange:function(t){n.adjustPlayToken(e,e.name,e.size,parseInt(t.target.value),e.y)},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:3},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_lmp_y_".concat(t)},"Y"),r.a.createElement(E.a,{id:"text_field_lmp_y_".concat(t),name:"text_field_lmp_y_".concat(t),type:"number",autoComplete:"Off",value:e.y,onChange:function(t){n.adjustPlayToken(e,e.name,e.size,e.x,parseInt(t.target.value))},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement("img",{src:e.token.file,style:{width:140},alt:e.name})),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.deletePlayToken(e)}},"Delete")))})))},n.moveLMP=function(e,t,a){if(n.props.selectedPlayMap){var r=n.props.selectedPlayMap,i=("light"===e.maskType?r.lightMasks:"dark"===e.maskType?r.darkMasks:r.fogMasks).filter((function(t){return t.id===e.maskID}));if(1===i.length){var o=i[0].points.filter((function(t){return t.id===e.id}));if(1===o.length){var s=o[0];"x"===t?s.x=parseFloat(a):s.y=parseFloat(a)}}n.props.updatePlayMap(r),n.setState({lastRefresh:new Date})}},n.addNewPoint=function(e){if(n.props.selectedPlayMap){var t=n.props.selectedPlayMap,a=("light"===e.maskType?t.lightMasks:"dark"===e.maskType?t.darkMasks:t.fogMasks).filter((function(t){return t.id===e.id}));if(1===a.length){var r=a[0],i=r.points[0];r.points.push(new z(r.points.length,r.id,r.maskType,i.x+1,i.y+1)),n.props.updatePlayMap(t),n.setState({lastRefresh:new Date})}}},n.deletePoint=function(e){if(n.props.selectedPlayMap){var t=n.props.selectedPlayMap,a=("light"===e.maskType?t.lightMasks:"dark"===e.maskType?t.darkMasks:t.fogMasks).filter((function(t){return t.id===e.maskID}));if(1===a.length){var r=a[0];r.points=r.points.filter((function(t){return t.id!==e.id})),r.points.filter((function(t){return t.id>e.id})).forEach((function(e){e.id--})),n.props.updatePlayMap(t),n.setState({lastRefresh:new Date})}}},n.deleteMask=function(e){if(n.props.selectedPlayMap){var t=n.props.selectedPlayMap,a="light"===e.maskType?t.lightMasks:"dark"===e.maskType?t.darkMasks:t.fogMasks;(a=a.filter((function(t){return t.id!==e.id}))).filter((function(t){return t.id>e.id})).forEach((function(e){e.id--})),"light"===e.maskType?t.lightMasks=a:"dark"===e.maskType?t.darkMasks=a:t.fogMasks=a,n.props.updatePlayMap(t),n.setState({lastRefresh:new Date})}},n.renderMaskList=function(){var e="light"===n.state.controlSubMode?n.props.selectedPlayMap.lightMasks:"dark"===n.state.controlSubMode?n.props.selectedPlayMap.darkMasks:n.props.selectedPlayMap.fogMasks;return r.a.createElement(m.a,{container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0},"light"===n.state.controlSubMode?"Light Masks":"dark"===n.state.controlSubMode?"Dark Masks":"Fog Masks"),e.map((function(e,t){return r.a.createElement(m.a,{item:!0,key:t,style:{cursor:"pointer",backgroundColor:null!==n.state.selectedMask&&e===n.state.selectedMask?"blue":"transparent"},container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0,onClick:function(){n.setState({selectedMask:e})}},e.toClipPath(n.props.selectedPlayMap.map.gridWidth,n.props.selectedPlayMap.map.gridHeight)),null!==n.state.selectedMask&&e===n.state.selectedMask&&r.a.createElement(m.a,{item:!0,container:!0,spacing:1,direction:"column"},e.points.map((function(e,t){return r.a.createElement(m.a,{item:!0,container:!0,key:t,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_lmp_x_".concat(t)},"X"),r.a.createElement(E.a,{id:"text_field_lmp_x_".concat(t),name:"text_field_lmp_x_".concat(t),type:"number",autoComplete:"Off",value:e.x,onChange:function(t){n.moveLMP(e,"x",t.target.value)},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_lmp_y_".concat(t)},"Y"),r.a.createElement(E.a,{id:"text_field_lmp_y_".concat(t),name:"text_field_lmp_y_".concat(t),type:"number",autoComplete:"Off",value:e.y,onChange:function(t){n.moveLMP(e,"y",t.target.value)},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:12},r.a.createElement(v.a,{onClick:function(){n.deletePoint(e)}},"Delete")))})),r.a.createElement(m.a,{item:!0},r.a.createElement(v.a,{onClick:function(){n.addNewPoint(e)}},"Add New Point"),r.a.createElement(v.a,{onClick:function(){n.deleteMask(e)}},"Delete Mask"))))})))},n.addNewMask=function(){if(n.props.selectedPlayMap){var e=n.props.selectedPlayMap,t="light"===n.state.controlSubMode?e.lightMasks:"dark"===n.state.controlSubMode?e.darkMasks:e.fogMasks,a=[new z(0,t.length,n.state.controlSubMode,0,0),new z(1,t.length,n.state.controlSubMode,1,0),new z(2,t.length,n.state.controlSubMode,1,1),new z(3,t.length,n.state.controlSubMode,0,1)];t.push(new R(t.length,n.state.controlSubMode,a)),n.props.updatePlayMap(e),n.setState({lastRefresh:new Date})}},n.renderControls=function(){return n.props.selectedPlayMap&&"DM"===n.props.mode?"tokens"===n.state.controlMode?r.a.createElement(X,{key:"controls",style:{width:300}},r.a.createElement(J,null,"Tokens"),r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"add"})}},"Add")),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"edit"})}},"Edit"))),"add"===n.state.controlSubMode?r.a.createElement(m.a,{container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:4},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_name"},"Name"),r.a.createElement(E.a,{id:"text_field_play_token_name",name:"text_field_play_token_name",type:"text",autoComplete:"Off",value:n.state.tokenName,onChange:function(e){n.setState({tokenName:e.target.value})},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:4},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_size"},"Size"),r.a.createElement(E.a,{id:"text_field_play_token_size",name:"text_field_play_token_size",type:"number",autoComplete:"Off",value:n.state.tokenSize,onChange:function(e){n.setState({tokenSize:parseFloat(e.target.value)})},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:4},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_count"},"Count"),r.a.createElement(E.a,{id:"text_field_play_token_count",name:"text_field_play_token_count",type:"number",autoComplete:"Off",value:n.state.tokenCount,onChange:function(e){n.setState({tokenCount:Math.max(1,parseInt(e.target.value))})},labelWidth:40,fullWidth:!0})))),r.a.createElement(m.a,{item:!0},r.a.createElement("div",{style:{height:window.innerHeight-400,overflowX:"hidden",overflowY:"scroll"}},r.a.createElement(m.a,{container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0},n.renderFavoriteTokenList(!1)),r.a.createElement(m.a,{item:!0},n.renderTokenList()))))):r.a.createElement(m.a,{container:!0,spacing:1,direction:"column",style:{height:window.innerHeight-300,overflowX:"hidden",overflowY:"scroll"}},n.renderPlayTokenList()),r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},"add"===n.state.controlSubMode&&r.a.createElement(v.a,{onClick:n.addNewToken,variant:"contained",color:"primary",disabled:""===n.state.tokenName||null===n.state.selectedToken&&null===n.state.selectedFavoriteToken},"Add New Token")),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlMode:"main"})},variant:"contained",color:"primary"},"Close")))):"masks"===n.state.controlMode?r.a.createElement(X,{key:"controls",style:{width:300}},r.a.createElement(J,null,"Masks"),r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:4},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"light"})}},"Light")),r.a.createElement(m.a,{item:!0,xs:4},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"dark"})}},"Dark")),r.a.createElement(m.a,{item:!0,xs:4},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"fog"})}},"Fog"))),r.a.createElement(m.a,{container:!0,spacing:1,direction:"column"},r.a.createElement(m.a,{item:!0,style:{height:window.innerHeight-280,overflowX:"hidden",overflowY:"scroll"}},n.renderMaskList()),r.a.createElement(m.a,{item:!0,container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:n.addNewMask,variant:"contained",color:"primary"},"Add New Mask")),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlMode:"main"})},variant:"contained",color:"primary"},"Close"))))):"favorites"===n.state.controlMode?r.a.createElement(X,{key:"controls",style:{width:300}},r.a.createElement(J,null,"Favorites"),r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"add"})}},"Add")),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlSubMode:"edit"})}},"Edit"))),"add"===n.state.controlSubMode?r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_name"},"Name"),r.a.createElement(E.a,{id:"text_field_play_token_name",name:"text_field_play_token_name",type:"text",autoComplete:"Off",value:n.state.tokenName,onChange:function(e){n.setState({tokenName:e.target.value})},labelWidth:40,fullWidth:!0}))),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(M.a,{variant:"outlined",fullWidth:!0},r.a.createElement(b.a,{htmlFor:"text_field_play_token_size"},"Size"),r.a.createElement(E.a,{id:"text_field_play_token_size",name:"text_field_play_token_size",type:"number",autoComplete:"Off",value:n.state.tokenSize,onChange:function(e){n.setState({tokenSize:parseFloat(e.target.value)})},labelWidth:40,fullWidth:!0}))),r.a.createElement("div",{style:{height:window.innerHeight-400,overflowX:"hidden",overflowY:"scroll"}},n.renderTokenList())):r.a.createElement("div",{style:{height:window.innerHeight-300,overflowX:"hidden",overflowY:"scroll"}},n.renderFavoriteTokenList(!0)),r.a.createElement(m.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(m.a,{item:!0,xs:6},"add"===n.state.controlSubMode&&r.a.createElement(v.a,{onClick:n.addNewFavorite,variant:"contained",color:"primary",disabled:""===n.state.tokenName||null===n.state.selectedToken},"Add New Favorite")),r.a.createElement(m.a,{item:!0,xs:6},r.a.createElement(v.a,{onClick:function(){n.setState({controlMode:"main"})},variant:"contained",color:"primary"},"Close")))):r.a.createElement(X,{key:"controls"},r.a.createElement("div",{onClick:n.zoomIn},r.a.createElement(Z,null,"+")),r.a.createElement("div",{onClick:n.zoomOut},r.a.createElement(Z,null,"-")),r.a.createElement("div",{onClick:n.clearSelectAndHover},"pan"===n.state.mapMode?"P":"M"),r.a.createElement("div",{onClick:function(){n.setState({controlMode:"tokens",controlSubMode:"add"})}},"T"),r.a.createElement("div",{onClick:function(){n.setState({controlMode:"masks",controlSubMode:"light"})}},"L"),r.a.createElement("div",{onClick:function(){n.setState({controlMode:"favorites",controlSubMode:"add"})}},"F")):r.a.createElement("div",{key:"controls"})},n.onKeyDown=function(e){"Shift"===e.key?n.state.shiftHeld||n.setState({shiftHeld:!0}):"Control"===e.key?n.state.ctrlHeld||n.setState({ctrlHeld:!0}):"Alt"===e.key?n.clearSelectAndHover():"w"===e.key?n.slideSelected(0,-1):"a"===e.key?n.slideSelected(-1,0):"s"===e.key?n.slideSelected(0,1):"d"===e.key?n.slideSelected(1,0):console.log(e)},n.slideSelected=function(e,t){var a=n.props.selectedPlayMap;n.state.selected.forEach((function(n){if(n instanceof I){var r=n,i=a.tokens.filter((function(e){return e.id===r.id}));if(1===i.length){var o=i[0];o.x+=e,o.y+=t}}else if(n instanceof z){var s=n;if("light"===s.maskType){var l=a.lightMasks.filter((function(e){return e.id===s.maskID}));if(1===l.length){var c=l[0].points.filter((function(e){return e.id===s.id}));if(1===c.length){var p=c[0];p.x+=e,p.y+=t}}}else if("dark"===s.maskType){var d=a.darkMasks.filter((function(e){return e.id===s.maskID}));if(1===d.length){var u=d[0].points.filter((function(e){return e.id===s.id}));if(1===u.length){var f=u[0];f.x+=e,f.y+=t}}}else if("fog"===s.maskType){var m=a.fogMasks.filter((function(e){return e.id===s.maskID}));if(1===m.length){var h=m[0].points.filter((function(e){return e.id===s.id}));if(1===h.length){var g=h[0];g.x+=e,g.y+=t}}}}})),n.props.updatePlayMap(a),n.setState({lastRefresh:new Date})},n.onKeyUp=function(e){"Shift"===e.key?n.state.shiftHeld&&n.setState({shiftHeld:!1}):"Control"===e.key&&n.state.ctrlHeld&&n.setState({ctrlHeld:!1})},n.state={mapMode:"pan",selected:[],hovered:null,shiftHeld:!1,ctrlHeld:!1,deselecting:!1,controlMode:"main",controlSubMode:"add",lastRefresh:new Date,tokenName:"",tokenSize:1,tokenCount:1,selectedToken:null,selectedFavoriteToken:null,selectedMask:null,countdown:2,refreshing:!1},n.api=C.getInstance(),"DM"!==e.mode&&setTimeout(n.countdown,1e3),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyDown.bind(this)),document.removeEventListener("keyup",this.onKeyUp.bind(this))}},{key:"render",value:function(){var e=this,t=Object(k.b)(H)(K(),G);return[this.renderControls(),r.a.createElement(t,{key:"main",zoom:this.props.selectedPlayMap.zoom,pandx:this.props.selectedPlayMap.dx,pandy:this.props.selectedPlayMap.dy,onPan:this.onPan,onClick:this.onClick,enableClick:"move"===this.state.mapMode},r.a.createElement("div",{style:{position:"relative",left:-1*window.innerWidth/2+0,top:-1*window.innerHeight/2+25}},"DM"===this.props.mode?r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,opacity:.5,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight},src:this.props.selectedPlayMap.map.file,alt:"Fog of War"}):r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight},src:N.a,alt:"Fog of War"}),r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,clipPath:"url(#lightMask)"},src:this.props.selectedPlayMap.map.file,alt:"Light Mask"}),r.a.createElement("svg",{width:"0",height:"0"},r.a.createElement("defs",null,r.a.createElement("clipPath",{id:"lightMask"},this.props.selectedPlayMap.lightMasks.map((function(t,a){return r.a.createElement("polygon",{key:a,points:t.toClipPath(e.props.selectedPlayMap.map.gridWidth,e.props.selectedPlayMap.map.gridHeight)})}))))),r.a.createElement("svg",{width:"0",height:"0"},r.a.createElement("defs",null,r.a.createElement("clipPath",{id:"darkMask"},this.props.selectedPlayMap.darkMasks.map((function(t,a){return r.a.createElement("polygon",{key:a,points:t.toClipPath(e.props.selectedPlayMap.map.gridWidth,e.props.selectedPlayMap.map.gridHeight)})}))))),r.a.createElement("svg",{width:"0",height:"0"},r.a.createElement("defs",null,r.a.createElement("clipPath",{id:"fogMask"},this.props.selectedPlayMap.fogMasks.map((function(t,a){return r.a.createElement("polygon",{key:a,points:t.toClipPath(e.props.selectedPlayMap.map.gridWidth,e.props.selectedPlayMap.map.gridHeight)})}))))),"DM"===this.props.mode&&r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,clipPath:"url(#fogMask)"},src:N.a,alt:"Fog Mask 1"}),"DM"===this.props.mode&&r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,opacity:.3,clipPath:"url(#fogMask)"},src:this.props.selectedPlayMap.map.file,alt:"Fog Mask 2"}),"DM"===this.props.mode&&r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,opacity:.7,clipPath:"url(#darkMask)"},src:N.a,alt:"Dark Mask"}),this.props.selectedPlayMap.tokens.map((function(t,a){return r.a.createElement("div",{key:a,style:{position:"absolute",left:50*t.x+window.innerWidth/2-25-25*t.size,top:50*t.y+window.innerHeight/2-25-25*t.size,width:50*t.size,height:50*t.size,backgroundColor:e.state.selected.includes(t)?"blue":"transparent",borderRadius:25*t.size},onMouseEnter:function(){e.setState({hovered:t})},onMouseLeave:function(){e.setState({hovered:null})}},r.a.createElement("img",{src:t.token.file,alt:"testing",style:{width:50*t.size,height:50*t.size}}),r.a.createElement("span",{style:{color:"black",fontWeight:"bold"}},t.name))})),"DM"!==this.props.mode&&r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,clipPath:"url(#fogMask)"},src:N.a,alt:"Fog Mask 1"}),"DM"!==this.props.mode&&r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,opacity:.5,clipPath:"url(#fogMask)"},src:this.props.selectedPlayMap.map.file,alt:"Fog Mask 2"}),"DM"!==this.props.mode&&r.a.createElement("img",{style:{position:"absolute",left:-25*this.props.selectedPlayMap.map.gridWidth+window.innerWidth/2,top:-25*this.props.selectedPlayMap.map.gridHeight+window.innerHeight/2-25,width:50*this.props.selectedPlayMap.map.gridWidth,height:50*this.props.selectedPlayMap.map.gridHeight,clipPath:"url(#darkMask)"},src:N.a,alt:"Dark Mask"}),"DM"===this.props.mode&&this.props.selectedPlayMap.lightMasks.map((function(t,a){return r.a.createElement("div",{key:a},t.points.map((function(t,a){return r.a.createElement("div",{key:a,style:{position:"absolute",left:50*t.x+window.innerWidth/2-60,top:50*t.y+window.innerHeight/2-60,width:20,height:20,backgroundColor:e.state.selected.includes(t)?"green":"yellow",borderRadius:5},onMouseEnter:function(){e.setState({hovered:t})},onMouseLeave:function(){e.setState({hovered:null})}},t.id)})))})),"DM"===this.props.mode&&this.props.selectedPlayMap.darkMasks.map((function(t,a){return r.a.createElement("div",{key:a},t.points.map((function(t,a){return r.a.createElement("div",{key:a,style:{position:"absolute",left:50*t.x+window.innerWidth/2-60,top:50*t.y+window.innerHeight/2-60,width:20,height:20,backgroundColor:e.state.selected.includes(t)?"green":"purple",borderRadius:5},onMouseEnter:function(){e.setState({hovered:t})},onMouseLeave:function(){e.setState({hovered:null})}},t.id)})))})),"DM"===this.props.mode&&this.props.selectedPlayMap.fogMasks.map((function(t,a){return r.a.createElement("div",{key:a},t.points.map((function(t,a){return r.a.createElement("div",{key:a,style:{position:"absolute",left:50*t.x+window.innerWidth/2-60,top:50*t.y+window.innerHeight/2-60,width:20,height:20,backgroundColor:e.state.selected.includes(t)?"green":"grey",borderRadius:5},onMouseEnter:function(){e.setState({hovered:t})},onMouseLeave:function(){e.setState({hovered:null})}},t.id)})))}))))]}}]),a}(n.Component));function $(){var e=Object(y.a)(["\n  background: dimgrey;\n  color: white;\n  height: ","px;\n  display: flex;\n  align-items: center;\n  padding-left: 10px;\n"]);return $=function(){return e},e}var ee=k.b.div($(),50),te=Object(u.b)((function(e){return{tokens:e.app.tokens,selectedPlayMap:e.app.selectedPlayMap}}),{selectPlayMap:function(e){return{type:"SELECT_PLAYMAP",payload:e}},updatePlayMap:function(e){return{type:"UPDATE_PLAYMAP",payload:e}}})(function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).api=void 0,n.createPlayMap=function(){n.setState({mode:"create"})},n.loadPlayMap=function(){n.setState({mode:"load"})},n.savePlayMap=function(){n.api.updatePlayMap(n.props.selectedPlayMap.toDBObj()).then((function(){}))},n.selectPlayMap=function(e){n.props.selectPlayMap(e),n.setState({mode:"main"})},n.renderHeader=function(){return r.a.createElement(ee,{key:"heading"},"Dead Simple VTT - DM Page",r.a.createElement(v.a,{onClick:n.createPlayMap},"Create PlayMap"),r.a.createElement(v.a,{onClick:n.loadPlayMap},"Load PlayMap"),r.a.createElement(v.a,{onClick:n.savePlayMap,disabled:null===n.props.selectedPlayMap},"Save PlayMap (I'll change this to auto-save later)"))},n.renderMain=function(){return"load"===n.state.mode?r.a.createElement(W,{key:"main",mode:"DM",selectPlayMap:n.selectPlayMap}):"create"===n.state.mode?r.a.createElement(j,{key:"main",selectPlayMap:n.selectPlayMap}):n.props.selectedPlayMap?r.a.createElement(q,{key:"main",mode:"DM"}):r.a.createElement("div",{key:"main",style:{margin:10}},"Load a Map to see it here")},n.state={mode:"load",selectedTokenID:-1,hoveredTokenID:-1,deselecting:!1},n.api=C.getInstance(),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return[this.renderHeader(),this.renderMain()]}}]),a}(n.Component));function ae(){var e=Object(y.a)(["\n  background: dimgrey;\n  color: white;\n  height: ","px;\n  display: flex;\n  align-items: center;\n  padding-left: 10px;\n"]);return ae=function(){return e},e}var ne=k.b.div(ae(),50),re=Object(u.b)((function(e){return{tokens:e.app.tokens,selectedPlayMap:e.app.selectedPlayMap,maps:e.app.maps}}),{selectPlayMap:function(e){return{type:"SELECT_PLAYMAP",payload:e}},updatePlayMap:function(e){return{type:"UPDATE_PLAYMAP",payload:e}}})(function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).api=void 0,n.loadPlayMap=function(){n.setState({mode:"load"})},n.selectPlayMap=function(e){n.props.selectPlayMap(e),n.setState({mode:"main"})},n.renderHeader=function(){return r.a.createElement(ne,{key:"heading"},"Dead Simple VTT",r.a.createElement(v.a,{onClick:n.loadPlayMap},"Load PlayMap"))},n.renderMain=function(){return"load"===n.state.mode?r.a.createElement(W,{key:"main",mode:"player",selectPlayMap:n.selectPlayMap}):n.props.selectedPlayMap?r.a.createElement(q,{key:"main",mode:"Player"}):r.a.createElement("div",{key:"main",style:{margin:10}},"Load a Map to see it here")},n.state={mode:"load",countdown:-1,refreshing:!1},n.api=C.getInstance(),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return[this.renderHeader(),this.renderMain()]}}]),a}(n.Component)),ie=a(59),oe=a.n(ie),se=a(60),le=a.n(se),ce=a(61),pe=a.n(ce),de=a(62),ue=a.n(de),fe=a(63),me=a.n(fe),he=a(64),ge=a.n(he),ye=a(65),ke=a.n(ye),ve=a(66),Me=a.n(ve),be=a(67),Ee=a.n(be),we=a(68),xe=a.n(we),Pe=a(69),Ae=a.n(Pe),_e=a(70),Se=a.n(_e),Te=a(71),De=a.n(Te),Oe=a(72),Ce=a.n(Oe),je=a(73),We=a.n(je),Fe=a(74),He=a.n(Fe),Ie=a(75),ze=a.n(Ie),Re=a(76),Be=a.n(Re),Le=a(77),Ne=a.n(Le),Ke=a(78),Ye=a.n(Ke),Qe={BasementStudy:oe.a,CastleWall:le.a,CaveLair:pe.a,Crossroads:ue.a,Farmstead:me.a,ForestLair:ge.a,MonsterLair:ke.a,SnowVillage:Me.a,SwampLair:Ee.a,Tavern:xe.a,UndergroundComplex:Ae.a,UrbanLair:Se.a,WagonTrailandShrine:De.a,WaterfallCavern:Ce.a,AbandonedWarehouse:We.a,DaggerAlley:He.a,UnderDaggerAlley:ze.a,TrollSkullAlleyBasement:Be.a,TrollSkullAlleyHouse:Ne.a,WeddingRing:Ye.a},Ue=function e(t,a,n,r,i){Object(s.a)(this,e),this._id=void 0,this.name=void 0,this.file=void 0,this.gridWidth=void 0,this.gridHeight=void 0,this._id=t,this.name=a,this.file=Qe[n],this.gridWidth=r,this.gridHeight=i},Ve=a(79),Ge=a.n(Ve),Xe=a(80),Je=a.n(Xe),Ze=a(81),qe=a.n(Ze),$e=a(82),et=a.n($e),tt=a(83),at=a.n(tt),nt=a(84),rt=a.n(nt),it=a(85),ot=a.n(it),st=a(86),lt=a.n(st),ct=a(87),pt=a.n(ct),dt=a(88),ut=a.n(dt),ft=a(89),mt=a.n(ft),ht=a(90),gt=a.n(ht),yt=a(91),kt=a.n(yt),vt=a(92),Mt=a.n(vt),bt=a(93),Et=a.n(bt),wt=a(94),xt=a.n(wt),Pt=a(95),At=a.n(Pt),_t=a(96),St=a.n(_t),Tt=a(97),Dt=a.n(Tt),Ot=a(98),Ct=a.n(Ot),jt=a(99),Wt=a.n(jt),Ft=a(100),Ht=a.n(Ft),It=a(101),zt=a.n(It),Rt=a(102),Bt=a.n(Rt),Lt=a(103),Nt=a.n(Lt),Kt=a(104),Yt=a.n(Kt),Qt=a(105),Ut=a.n(Qt),Vt=a(106),Gt=a.n(Vt),Xt=a(107),Jt=a.n(Xt),Zt=a(108),qt=a.n(Zt),$t=a(109),ea=a.n($t),ta=a(110),aa=a.n(ta),na=a(111),ra=a.n(na),ia=a(112),oa=a.n(ia),sa=a(113),la=a.n(sa),ca=a(114),pa=a.n(ca),da=a(115),ua=a.n(da),fa=a(116),ma=a.n(fa),ha=a(117),ga=a.n(ha),ya=a(118),ka=a.n(ya),va=a(119),Ma=a.n(va),ba=a(120),Ea=a.n(ba),wa=a(121),xa=a.n(wa),Pa=a(122),Aa=a.n(Pa),_a={Bald:Ge.a,Bard:Je.a,BlondeHair:qe.a,BlondeWoman:et.a,BlueSkin:at.a,BlueSkin2:rt.a,DarkSkin:ot.a,DarkSkinF:lt.a,Dragonborn:pt.a,DragonbornFighter:ut.a,DwarfMale:mt.a,ElvenFemale:gt.a,ElvenFighter:kt.a,Eyebrows:Mt.a,Eyebrows2:Et.a,Fedora:xt.a,GnomeMale:At.a,GoliathBarb:St.a,GreyHair:Dt.a,HalflingMale:Ct.a,Hood:Wt.a,Hood2:Ht.a,Human:zt.a,HumanFemale:Bt.a,HumanFemale2:Nt.a,HumanFighterF:Yt.a,HumanFighterM:Ut.a,HumanMale:Gt.a,HumanMale2:Jt.a,IDK:qt.a,Knight:ea.a,OldWoman:aa.a,OldWoman2:ra.a,RedHair:oa.a,RedSkin:la.a,Samurai:pa.a,Scarf:ua.a,TieflingFemale:ma.a,Wizard:ga.a,Rat:ka.a,Wererat:Ma.a,Werewolf:Ea.a,RugOfSmothering:xa.a,PitTrapWSpikes:Aa.a},Sa=function e(t,a){Object(s.a)(this,e),this._id=void 0,this.file=void 0,this._id=t,this.file=_a[a]},Ta=Object(u.b)((function(e){return{maps:e.app.maps}}),{setMaps:function(e){return{type:"SET_MAPS",payload:e}},setPlayMaps:function(e){return{type:"SET_PLAYMAPS",payload:e}},setTokens:function(e){return{type:"SET_TOKENS",payload:e}},setFavoriteTokens:function(e){return{type:"SET_FAVORITETOKENS",payload:e}}})(function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).api=void 0,n.state={version:"0"},n.api=C.getInstance(),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return null===this.props.maps?(this.api.getAllVTT(0,!0).then((function(t){if(void 0!==t&&void 0===t.error){var a=[];t.maps.forEach((function(e){a.push(new Ue(e._id,e.name,e.fileName,e.gridWidth,e.gridHeight))})),e.props.setMaps(a);var n=[];t.tokens.forEach((function(e){n.push(new Sa(e._id,e.fileName))})),e.props.setTokens(n);var r=[];t.favoriteTokens.forEach((function(e){var t=n.filter((function(t){return t._id===e.tokenID}));if(1===t.length){var a=t[0];r.push(new B(e._id,e.name,a,e.size))}})),e.props.setFavoriteTokens(r);var i=[];t.playMaps.forEach((function(e){var t=a.filter((function(t){return t._id===e.mapID}));if(1===t.length){var r=t[0],o=[];e.playTokens.forEach((function(e){var t=n.filter((function(t){return t._id===e.tokenID}));if(1===t.length){var a=t[0];o.push(new I(e.id,e.name,a,e.x,e.y,e.size))}}));var s=[];e.lightMasks.forEach((function(e){var t=[];e.points.forEach((function(a){t.push(new z(a.id,e.id,"light",a.x,a.y))})),s.push(new R(e.id,"light",t))}));var l=[];e.darkMasks.forEach((function(e){var t=[];e.points.forEach((function(a){t.push(new z(a.id,e.id,"dark",a.x,a.y))})),l.push(new R(e.id,"dark",t))}));var c=[];e.fogMasks.forEach((function(e){var t=[];e.points.forEach((function(a){t.push(new z(a.id,e.id,"fog",a.x,a.y))})),c.push(new R(e.id,"fog",t))})),i.push(new x(e._id,e.name,r,o,s,l,c,e.zoom,e.dx,e.dy))}})),e.props.setPlayMaps(i)}})),r.a.createElement("div",{key:"main"},"Loading Data")):r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/",component:g}),r.a.createElement(f.b,{exact:!0,path:"/home",component:g}),r.a.createElement(f.b,{exact:!0,path:"/dm",component:te}),r.a.createElement(f.b,{exact:!0,path:"/player",component:re}))}}]),a}(n.Component));a(141);var Da=function(e){Object(c.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).api=void 0,n.props=void 0,n.state={version:"0",width:0,innerWidth:0,marginLeft:220},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){}},{key:"render",value:function(){return r.a.createElement(d.a,null,r.a.createElement(m.a,{container:!0},r.a.createElement(m.a,{item:!0,xs:12},r.a.createElement(Ta,null))))}}]),a}(n.Component),Oa=Object(u.b)((function(e){return{}}),(function(e){return{}}))(Da);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ca=a(37),ja=a(48),Wa={maps:null,tokens:null,playMaps:null,favoriteTokens:null,selectedPlayMap:null,isOn:!0};var Fa={app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wa,t=arguments.length>1?arguments[1]:void 0;if("SET_MAPS"===t.type)return Object.assign({},e,{maps:t.payload});if("SET_TOKENS"===t.type)return Object.assign({},e,{tokens:t.payload});if("SET_PLAYMAPS"===t.type)return Object.assign({},e,{playMaps:t.payload});if("SET_FAVORITETOKENS"===t.type)return Object.assign({},e,{favoriteTokens:t.payload});if("ADD_MAP"===t.type){var a=e.maps;return a.push(t.payload),Object.assign({},e,{maps:a})}if("ADD_TOKEN"===t.type){var n=e.tokens;return n.push(t.payload),Object.assign({},e,{tokens:n})}if("ADD_PLAYMAP"===t.type){var r=e.playMaps;return r.push(t.payload),Object.assign({},e,{playMaps:r})}if("ADD_FAVORITETOKEN"===t.type){var i=e.favoriteTokens;return i.push(t.payload),Object.assign({},e,{favoriteTokens:i})}if("UPDATE_MAP"===t.type){var o=e.maps,s=o.filter((function(e){return e._id===t.payload._id}));if(1===s.length){var l=s[0];l.name=t.payload.name,l.file=t.payload.file,l.gridWidth=t.payload.gridWidth,l.gridHeight=t.payload.gridHeight}return Object.assign({},e,{maps:o})}if("UPDATE_TOKEN"===t.type){var c=e.tokens,p=c.filter((function(e){return e._id===t.payload._id}));if(1===p.length){var d=p[0];d.file=t.payload.file}return Object.assign({},e,{tokens:c})}if("UPDATE_PLAYMAP"===t.type){var u=e.playMaps,f=e.selectedPlayMap,m=u.filter((function(e){return e._id===t.payload._id}));if(1===m.length){var h=m[0];h.name=t.payload.name,h.map=t.payload.map,h.tokens=t.payload.tokens,h.lightMasks=t.payload.lightMasks,h.zoom=t.payload.zoom,h.dx=t.payload.dx,h.dy=t.payload.dy,f._id===h._id&&(f=h)}return Object.assign({},e,{playMaps:u,selectedPlayMap:f})}if("UPDATE_FAVORITETOKEN"===t.type){var g=e.favoriteTokens,y=g.filter((function(e){return e._id===t.payload._id}));if(1===y.length){var k=y[0];k.file=t.payload.file}return Object.assign({},e,{favoriteTokens:g})}return"SELECT_PLAYMAP"===t.type?Object.assign({},e,{selectedPlayMap:t.payload}):"TOGGLE_IS_ON"===t.type?Object.assign({},e,{isOn:!e.isOn}):e},session:ja.sessionReducer},Ha=Object(Ca.b)(Fa),Ia=Object(Ca.c)(Ha),za={refreshFromLocalStorage:!0,refreshOnCheckAuth:!0,redirectPath:"/home",driver:"COOKIES",validateSession:function(e){return!0}};ja.sessionService.initSessionService(Ia,za).then((function(){return console.log("Redux React Session is ready and a session was refreshed from your storage")})).catch((function(){return console.log("Redux React Session is ready and there is no session in your storage")}));var Ra=Ia;o.a.render(r.a.createElement(u.a,{store:Ra},r.a.createElement(Oa,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}]),[[127,1,2]]]);
//# sourceMappingURL=main.684fa0c3.chunk.js.map